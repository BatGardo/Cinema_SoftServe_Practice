<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Page Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="~/css/header-style.css">
    <link rel="stylesheet" href="~/css/add-movie.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arimo:ital,wght@0,400..700;1,400..700&display=swap"
        rel="stylesheet">
</head>
        <div class="admin-list-container container">
    <a asp-area="" asp-controller="Padmin" asp-action="AdminView">
        <span class="close">
                <svg viewBox="0 0 24 24" width="24" height="24">
                  <line x1="0" y1="0" x2="24" y2="24" stroke="white" stroke-width="5"/>
                  <line x1="24" y1="0" x2="0" y2="24" stroke="white" stroke-width="5"/>
                </svg>
            </a>
        </span>
            @* <form>
                <div class="container-caption"><u>Add movie</u></div>
                <div class="add-movie-flex">
                    <div class="poster-rating-container">
                        <div id="drop-area" class="add-poster">
                            <div class="add-text-img watchtime"><img src="~/img/add-button.svg"></div>
                            <input type="file" class="file-input" accept="image/jpeg, image/png, image/gif">
                        </div>
                        <input type="file" accept="image/jpeg, image/png, image/gif">
                        <div class="rating-flex d-flex">
                            <p>Rating:</p>
                            <input type="text" value="">
                        </div>
                    </div>
                    <div class="info-container">
                        <div class="title-flex d-flex">
                            <p>Title:</p>
                            <input type="text" value="">
                        </div>
                        <div class="description-flex d-flex">
                            <p>Description:</p>
                            <textarea value=""></textarea>
                        </div>
                        <div class="actors-flex d-flex">
                            <p id="actors-list">Actors:</p>
                            <input id="active-actor" type="text" readonly>
                            <div class="select-container">
                                <div class="add-actor-button">
                                    <img id="add-actor" src="~/img/add-button.svg">
                                </div>
                                <select class="actor-select" id="select-actor" placeholder="Оберіть актора...">
                                    <option>Уїлл Смітт</option>
                                    <option>Улїл Смітт</option>
                                    <option>Уїлл См</option>
                                    <option>Уїл Смітт</option>
                                    <option>Улл Смітт</option>
                                </select>
                            </div>
                        </div>
                        <div class="trailer-flex d-flex">
                            <p>Trailer link:</p>
                            <input type="text" value="">
                        </div>
                        <div class="year-duration-flex d-flex">
                            <div class="duration-flex d-flex">
                                <p>Duration:</p>
                                <input type="text" value="">
                                <span class="text-sm">h</span>
                                <input type="text" value="">
                                <span class="text-sm">m</span>
                            </div>
                            <div class="year-flex d-flex">
                                <p>Year:</p>
                                <input type="text" value="">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="genres-flex d-flex">
                    <p>Genres:</p>
                    <div class="genres-container">
                        <div class="properties-droplist-check">
                            <input type="checkbox" id="drama">
                            <label for="drama"><span></span>Drama</label>
                        </div>
                        <div class="properties-droplist-check">
                            <input type="checkbox" id="drama">
                            <label for="drama"><span></span>Drama</label>
                        </div>
                        <div class="properties-droplist-check">
                            <input type="checkbox" id="drama">
                            <label for="drama"><span></span>Drama</label>
                        </div>
                        <div class="properties-droplist-check">
                            <input type="checkbox" id="drama">
                            <label for="drama"><span></span>Drama</label>
                        </div>
                        <div class="properties-droplist-check">
                            <input type="checkbox" id="drama">
                            <label for="drama"><span></span>Drama</label>
                        </div>
                    </div>
                </div>
                <input type="submit" class="add-button">
            </form>
        </div> *@

    @model Cinema_Project.ViewModels.MovieAddVM

    <form asp-action="AddMovie" method="post" id="movieForm">
        <div>
            <label>Title:</label>
            <input type="text" asp-for="Title" />
        </div>
        <div>
            <label>Description:</label>
            <textarea asp-for="Description"></textarea>
        </div>
        <div>
            <label>Release Date:</label>
            <input type="date" asp-for="ReleaseDate" />
        </div>
        <div>
            <label>Duration:</label>
            <input type="number" asp-for="Duration" />
        </div>
        <div>
            <label>Rating:</label>
            <input type="number" step="0.1" asp-for="Rating" />
        </div>
        <div class="genres-flex d-flex">
            <p>Genres:</p>
            <div class="genres-container">
                @foreach (var genre in Model.Genres)
                {
                    <div class="properties-droplist-check">
                        <input type="checkbox" name="SelectedGenreIds" value="@genre.GenreId" id="genre_@genre.GenreId">
                        <label for="genre_@genre.GenreId"><span></span>@genre.Title</label>
                    </div>
                }
            </div>
        </div>
        <div>
            <label>Actors:</label>
            <div>
                <select id="actorSelect">
                    <option value="" disabled selected>Select Actor</option>
                    @foreach (var actor in Model.Actors)
                    {
                        <option value="@actor.ActorId">@actor.FirstName @actor.LastName</option>
                    }
                </select>
                <button type="button" onclick="addActor()">Add Actor</button>
            </div>
            <ul id="selectedActors">
            </ul>
        </div>
        <button type="button" onclick="generateSQLQuery()">Submit</button>
    </form>


    @section Scripts {
        <script>
            function addActor() {
                var actorSelect = document.getElementById("actorSelect");
                var selectedActors = document.getElementById("selectedActors");

                var selectedActorId = actorSelect.value;
                var selectedActorText = actorSelect.options[actorSelect.selectedIndex].text;

                if (selectedActorId) {
                    var listItem = document.createElement("li");
                    listItem.textContent = selectedActorText;

                    var hiddenInput = document.createElement("input");
                    hiddenInput.type = "hidden";
                    hiddenInput.name = "SelectedActorIds";
                    hiddenInput.value = selectedActorId;

                    var removeButton = document.createElement("button");
                    removeButton.type = "button";
                    removeButton.textContent = "Remove";
                    removeButton.onclick = function () {
                        listItem.remove();
                    };

                    listItem.appendChild(hiddenInput);
                    listItem.appendChild(removeButton);
                    selectedActors.appendChild(listItem);

                    actorSelect.value = "";
                }
            }

            function generateSQLQuery() {
                var form = document.getElementById("movieForm");

                var title = form.querySelector('input[name="Title"]').value;
                var description = form.querySelector('textarea[name="Description"]').value;
                var releaseDate = form.querySelector('input[name="ReleaseDate"]').value;
                var duration = form.querySelector('input[name="Duration"]').value;
                var rating = form.querySelector('input[name="Rating"]').value;

                var selectedGenres = Array.from(form.querySelectorAll('input[name="SelectedGenreIds"]:checked'))
                    .map(checkbox => checkbox.value);

                var selectedActors = Array.from(form.querySelectorAll('input[name="SelectedActorIds"]'))
                    .map(input => input.value);

                var movieQuery = `INSERT INTO movie (Title, Description, Release_Date, Duration, Rating) VALUES ('${title}', '${description}', '${releaseDate}', ${duration}, ${rating});`;

                var genreQueries = selectedGenres.map(genreId => {
                    return `INSERT INTO Movie_Genre (Movie_Id, Genre_Id)
                        SELECT MAX(movie_id), ${genreId}
                        FROM movie;`;
                });

                var actorQueries = selectedActors.map(actorId => {
                    return `INSERT INTO Movie_Actor (Movie_Id, Actor_Id)
                            SELECT MAX(movie_id), ${actorId}
                            FROM movie;`;
                });

                var sqlQuery = movieQuery + "\n" + genreQueries.join("\n") + "\n" + actorQueries.join("\n");

                // Отправка AJAX-запроса на сервер
                var xhr = new XMLHttpRequest();
                xhr.open("POST", "/Padmin/ExecuteSQL", true);
                xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                xhr.onreadystatechange = function () {

                };
                xhr.send(JSON.stringify({ sqlQuery: sqlQuery }));
            }
        </script>
    }













    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/js/standalone/selectize.min.js"
        integrity="sha256-+C0A5Ilqmu4QcSPxrlGpaZxJ04VjsRjKu+G82kl5UJk=" crossorigin="anonymous"></script>
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.6/css/selectize.bootstrap3.min.css"
        integrity="sha256-ze/OEYGcFbPRmvCnrSeKbRTtjG4vGLHXgOqsyLFTRjg=" crossorigin="anonymous" />

    <script src="~/js/seach-button.js"></script>
    <script src="~/js/no-actor-dulicate.js"></script>
    <script src="~/js/drop-area.js"></script>
    <script src="~/js/remove-actor.js"></script>
    <script>
        $(document).ready(function () {
            $('select').selectize({
                sortField: 'text'
            });
        });
    </script>